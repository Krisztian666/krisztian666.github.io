<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Mobil Akadémia</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
        <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>        
        <style>
             code{
                 counter-increment: linecounter;
    list-style-type: decimal;
    width: 100%;
    display: block;
    float: left;                 
    border-bottom: 1px solid #0000aa;
    margin: 10px 0;
             }
             pre{
                 font-size: xx-large;
             }
        </style>
        <script>
            
            var edContent=
        </script>
    </head>
    <body>
        <div>
        <h1></h1>
        <span></span>
        </div>
        <br><br>
        <div id="radio" style="width: 100%;display: block;float:left;"></div>

        <div id="sources" style="width:60%; display:block; float:left">
                <ul>
                </ul>
            </div>
        
            <div id="screen" style="width:35%; display:block;float:left">
                <ul>
                    <li><a href="#screen_view">screen</a></li>
                    <li><a href="#option_view">options</a></li>
                </ul>
                <div id="screen_view">
                    
                    <img src="">
                    <audio></audio>
                    <h3></h3>
                </div>
                <div id="option_view">
                    <table>
                        <tr>
                            <td> Gépelési sebesség: </td>
                            <td>  200 </td> <td> <input type="range" id="writespeed" min="50" max="200"> </td> <td>50 </td>
                        </tr>
                        <tr>
                            <td> Hangerő: </td>
                            <td>  0  </td> <td> <input type="range" id="power" min="0" max="100"> </td> <td> 100 </td>
                        </tr>
                    </table>
                </div>
            </div>
        
    
        <script>
            var dataSource;
            var lineIndex=0
            var playingIndex=0;
            $.ajax({
                url: GetURLParameter("path"), 
                success: function(result){
                    console.log(result)
                    eval("edContent="+result);

                    $("H1").html(edContent.title);
                    $("span").html(edContent.desc);
                    for(x in edContent.files){
                        $("#sources ul").append("<li><a href=\"#"+edContent.files[x].id+"\">"+edContent.files[x].title+"</a></li>");
                        $("#sources").append("<div id="+edContent.files[x].id+"  number=\""+x+"\"><pre></pre></div>");
                    }
                    $("#sources").tabs();
                    $("#screen").tabs();

                    for(x in edContent.playing){
                        $("#radio").append("<input type=\"radio\" id=\"radio"+x+"\" name=\"radio\"><label title=\""+edContent.playing[x].hint+"\" for=\"radio"+x+"\">"+x+"</label>");
                    }
                    $("#radio").buttonset();
                    playContent();
                }
            });
            
  	function GetURLParameter(sParam){
	    var sPageURL = window.location.search.substring(1);
	    var sURLVariables = sPageURL.split('&');
	    for (var i = 0; i < sURLVariables.length; i++){
	        var sParameterName = sURLVariables[i].split('=');
	        if (sParameterName[0] == sParam){
	            return sParameterName[1];
	        }
	    }
	}
        
            var showText = function (pCont, pozition, index, interval,pIDX) {
                message= ""+pCont["values"][pIDX].content+"";
                if (index < message.length) {
                    $("#"+pCont["container"]+" code:eq("+pozition+")").append(message[index]);
                    index++;
                    setTimeout(function () { showText(pCont, pozition, index, interval,pIDX); }, interval);
                }
                else if(pIDX<(pCont.values.length-1)) {
                    lineIndex++;
                    setTimeout(writeCode,2000);
                }
                else if(playingIndex<edContent.playing.length) {
                    playingIndex++;
                    setTimeout(playContent,4000);
                }
                
            }
            
            function addText(pCont,pIdx){
                console.log("AddText:"+pIdx);
                console.log("AddText:"+$("#"+pCont["container"]+"code:eq("+(pIdx-1)+")"));
                $("#"+pCont["container"]+" pre "+"code:eq("+(pCont.values[pIdx].position-1)+")").after("<code></code>");
                showText(pCont, pCont.values[pIdx].position,0, 100,pIdx);  
            }

            function newText(pCont,pIdx){
                console.log("NextText:"+pIdx);
                $("#"+pCont["container"]+" pre").append("<code></code>");
                showText(pCont, $("#"+pCont["container"]+" pre code").length-1, 0, 100,pIdx);  
                
            }


            function writeCode(){
                console.log("writeCode:"+lineIndex);
                $("#sources").tabs("option","active",$("#"+dataSource["container"]).attr("number"));
                if(dataSource.values[lineIndex]["delete"]==null)
                    $("#"+pCont["container"]+" pre "+"code:eq("+(pCont.values[pIdx].modify-1)+")").remove();
                else if(dataSource.values[lineIndex]["modify"]==null)
                    $("#"+pCont["container"]+" pre "+"code:eq("+(pCont.values[pIdx].modify-1)+")").css("bacground-color:red");
                else if(dataSource.values[lineIndex]["position"]==null)
                    newText(dataSource,lineIndex);
                else 
                    addText(dataSource,lineIndex);
            }
            
            function playContent(){
                dataSource=edContent.playing[playingIndex]["source"];
                if(edContent.playing[playingIndex].image!=null)
                    $("#screen img").attr("src",edContent.imagePath+edContent.playing[playingIndex].image);
                
                if(edContent.playing[playingIndex].hint!=null){
                    $("#screen h3").html(edContent.playing[playingIndex].hint);
                    $("#screen audio").attr("src","http://5.249.155.46:8080/SoundServer-1.0/sound?text="+edContent.playing[playingIndex].hint+".");
                  document.querySelector("#screen audio").play();
                }
                lineIndex=0;
                writeCode(dataSource);
            }

        </script>
    </body>
</html>
